/*!
 * Digital Sandbox v1.3.0 (https://github.com/codeworksdev/digital-sandbox)
 * Copyright (c) 2016 CODEWORKS <guru@codeworksnyc.com>
 * Licensed under the MIT license
 */
function DigitalSandboxWrapper(){this._vars(),this._toolbar(),this._init()}function DigitalSandboxApps(){this._vars(),this._init()}function DigitalSandboxToolbar(){this._vars(),this._html()}function DigitalSandboxDevice(){this._vars(),this._html()}Mochi_init=function(t){},$(document).ready(function(t){switch(Number($m.getView())){case 0:$m.extend("wrapper",DigitalSandboxWrapper);break;case 1:$m.extend("apps",DigitalSandboxApps)}}),DigitalSandboxWrapper.prototype={_vars:function(){if(this.ver={date:"2016-08-10",number:"1.3.0",product:"Digital Sandbox",type:"final"},this.ver.str=this.ver.product+" v"+this.ver.number+"-"+this.ver.date.replace(/\D/g,"")+"-"+this.ver.type,this.href=window.location.href,this.url={},this.iframe=$("#inner-content > iframe"),/^([^\?]+)(?:\?([^\?]*))?$/.test(this.href))switch(this.url.dir=RegExp.$1,this.url.query=RegExp.$2,this.url.type=/^https?:\/\//i.test(this.url.query)?"ext":"int",this.url.src="./apps.html",this.url.type){case"ext":this.url.src=this.url.query;break;case"int":/^([\w-:]+)(?:\/([\w-:]*))?$/.test(this.url.query)&&(this.url.index=RegExp.$2||"index",this.url.app=RegExp.$1.replace(/\:/g,"/"),this.url.ext="html",this.url.src="./frontend/apps/"+this.url.app+"/"+this.url.index+"."+this.url.ext)}},_toolbar:function(){$m.extend("toolbar",DigitalSandboxToolbar,function(){this.onload()})},_init:function(){this.iframe.attr("src",this.url.src)}},DigitalSandboxApps.prototype={_vars:function(){this.items=$m.content.find(".items a")},_init:function(){this.items.each(function(){var t=$(this),i=t.attr("href");/^\.\/\?/.test(i)&&t.attr("target","_top").on("click",function(t){var i=$(this),e={"new":i.attr("href")};try{e.old=window.parent.location.href,t.preventDefault(),window.frameElement?window.parent.location.replace(e["new"]):window.location.replace(/^(\.\/)(.+)$/.test(e["new"])?RegExp.$1+"index.html"+RegExp.$2:e["new"])}catch(n){/^https?:\/\//i.test(e["new"])||(i.attr("href",e["new"]=e["new"].replace(/\?\d+/,"")),/^(\.\/)(?:index\.html)?(\?.+)$/.test(e["new"])&&i.attr("href",e["new"]=RegExp.$1+"index.html?"+Math.floor(Date.now()/1e3)+RegExp.$2))}})})}},DigitalSandboxToolbar.prototype={_vars:function(){this.options={buttons:{refresh:"Refresh Window",qrefresh:"Quick Refresh",reload:"Refresh App",device:"Device Mode",rotate:"Orientation",launch:"Index",about:"About"}}},_html:function(){$m.container.prepend('<div id="toolbar">  <div id="inner-toolbar"></div></div>')},onload:function(){_.each(this.options.buttons,function(t,i){switch($("#inner-toolbar").append('<span data-button="'+i+'" title="'+t+'"></span>'),i){case"device":$m.extend(i,DigitalSandboxDevice,function(){this.onload()})}}),$m.onClick($("#inner-toolbar").find("> [data-button]"),function(){$m.toolbar.select(this)})},select:function(t){var i=_.isElement(t)?$(t):t,e=i.attr("data-button"),n="do"+window.s.capitalize(e);this[n](i)},doRefresh:function(t){window.location.reload(!0)},doReload:function(t){$m.wrapper.iframe.attr("src",$m.wrapper.iframe.attr("src"))},doQrefresh:function(t){try{$m.wrapper.iframe[0].contentWindow.location.reload()}catch(i){alert("This feature is not available in offline mode.")}},doLaunch:function(t){window.location.href=window.location.href.replace(/^([^\?]+)(\?.*)?$/,"$1"),$m.wrapper.iframe.attr("src","./apps.html")},doDevice:function(t){$m.device.open(t)},doRotate:function(t){$m.device.rotate()},doAbout:function(t){alert($m.wrapper.ver.str)}},DigitalSandboxDevice.prototype={_vars:function(){this.options={buttons:{"default":"Default",fullscreen:"Full Screen",ipad:"iPad",iphone_5s:"iPhone 5",iphone_6plus:"iPhone 6 Plus",galaxy_s5:"Galaxy S5",nexus_7:"Nexus 7",nexus_10:"Nexus 10"},container_id:"device-menu"}},_html:function(){this.container=$('#inner-toolbar [data-button="device"]').append('<div id="'+this.options.container_id+'">  <div id="inner-'+this.options.container_id+'">    <span data-action="exit"></span>  </div></div>').find("#"+this.options.container_id)},onload:function(){_.each(this.options.buttons,function(t,i){var e="inner-"+$m.device.options.container_id;switch($("#"+e).append('<span data-button="'+i+'"><span>'+t+"</span></span>"),i){case"default":$("#"+e+' [data-button="'+i+'"]').addClass("selected")}}),$m.onClick($("#inner-"+this.options.container_id).find("[data-button]"),function(){$m.device.select(this)}),$m.onClick($("#inner-"+this.options.container_id).find("[data-action]"),function(){$m.device.action(this)})},select:function(t){var i=_.isElement(t)?$(t):t,e=i.attr("data-button"),n=i.hasClass("selected");n||($("#inner-"+this.options.container_id+' [data-button="'+e+'"]').addClass("selected"),$("#inner-"+this.options.container_id+' :not([data-button="'+e+'"])').removeClass("selected"),$m.body.attr("data-device",e))},action:function(t){var i=_.isElement(t)?$(t):t,e=i.attr("data-action"),n=e;this[n]()},rotate:function(){var t="data-orientation",i=$m.body.attr(t),e=i&&"l"==i?"p":"l";$m.body.attr(t,e)},open:function(){this.container.hasClass("open")||this.container.addClass("open")},close:function(){this.container.removeClass("open")},exit:function(){setTimeout(function(){$m.device.close()},50)}};