/*! iScroll v5.2.0-snapshot ~ (c) 2008-2017 Matteo Spinelli ~ http://cubiq.org/license */
(function(a,d,g){function h(p,q){for(var r in this.wrapper='string'==typeof p?d.querySelector(p):p,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={mouseWheelSpeed:20,snapThreshold:0.334,infiniteUseTransform:!0,deceleration:4e-3,disablePointer:!o.hasPointer,disableTouch:o.hasPointer||!o.hasTouch,disableMouse:o.hasPointer||o.hasTouch,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:'',preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0,bindToWrapper:'undefined'==typeof a.onmousedown},q)this.options[r]=q[r];this.translateZ=this.options.HWCompositing&&o.hasPerspective?' translateZ(0)':'',this.options.useTransition=o.hasTransition&&this.options.useTransition,this.options.useTransform=o.hasTransform&&this.options.useTransform,this.options.eventPassthrough=!0===this.options.eventPassthrough?'vertical':this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY='vertical'!=this.options.eventPassthrough&&this.options.scrollY,this.options.scrollX='horizontal'!=this.options.eventPassthrough&&this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing='string'==typeof this.options.bounceEasing?o.ease[this.options.bounceEasing]||o.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,!0===this.options.tap&&(this.options.tap='tap'),this.options.useTransition||this.options.useTransform||/relative|absolute/i.test(this.scrollerStyle.position)||(this.scrollerStyle.position='relative'),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.options.infiniteElements&&(this.options.probeType=3),this.options.infiniteUseTransform=this.options.infiniteUseTransform&&this.options.useTransform,3==this.options.probeType&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}var j=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(p){a.setTimeout(p,1e3/60)},o=function(){function p(u){return!1!==s&&(''===s?u:s+u.charAt(0).toUpperCase()+u.substr(1))}var q={},r=d.createElement('div').style,s=function(){for(var v,u=['t','webkitT','MozT','msT','OT'],w=0,z=u.length;w<z;w++)if(v=u[w]+'ransform',v in r)return u[w].substr(0,u[w].length-1);return!1}();q.getTime=Date.now||function(){return new Date().getTime()},q.extend=function(u,v){for(var w in v)u[w]=v[w]},q.addEvent=function(u,v,w,z){u.addEventListener(v,w,!!z)},q.removeEvent=function(u,v,w,z){u.removeEventListener(v,w,!!z)},q.prefixPointerEvent=function(u){return a.MSPointerEvent?'MSPointer'+u.charAt(7).toUpperCase()+u.substr(8):u},q.momentum=function(u,v,w,z,A,B){var E,F,C=u-v,D=g.abs(C)/w;return B=void 0===B?6e-4:B,E=u+D*D/(2*B)*(0>C?-1:1),F=D/B,E<z?(E=A?z-A/2.5*(D/8):z,C=g.abs(E-u),F=C/D):0<E&&(E=A?A/2.5*(D/8):0,C=g.abs(u)+E,F=C/D),{destination:g.round(E),duration:F}};var t=p('transform');return q.extend(q,{hasTransform:!1!==t,hasPerspective:p('perspective')in r,hasTouch:'ontouchstart'in a,hasPointer:!!(a.PointerEvent||a.MSPointerEvent),hasTransition:p('transition')in r}),q.isBadAndroid=function(){var u=a.navigator.appVersion;if(/Android/.test(u)&&!/Chrome\/\d/.test(u)){var v=u.match(/Safari\/(\d+.\d)/);return v&&'object'==typeof v&&2<=v.length?535.19>parseFloat(v[1]):!0}return!1}(),q.extend(q.style={},{transform:t,transitionTimingFunction:p('transitionTimingFunction'),transitionDuration:p('transitionDuration'),transitionDelay:p('transitionDelay'),transformOrigin:p('transformOrigin'),touchAction:p('touchAction')}),q.hasClass=function(u,v){var w=new RegExp('(^|\\s)'+v+'(\\s|$)');return w.test(u.className)},q.addClass=function(u,v){if(!q.hasClass(u,v)){var w=u.className.split(' ');w.push(v),u.className=w.join(' ')}},q.removeClass=function(u,v){if(q.hasClass(u,v)){var w=new RegExp('(^|\\s)'+v+'(\\s|$)','g');u.className=u.className.replace(w,' ')}},q.offset=function(u){for(var v=-u.offsetLeft,w=-u.offsetTop;u=u.offsetParent;)v-=u.offsetLeft,w-=u.offsetTop;return{left:v,top:w}},q.preventDefaultException=function(u,v){for(var w in v)if(v[w].test(u[w]))return!0;return!1},q.extend(q.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),q.extend(q.ease={},{quadratic:{style:'cubic-bezier(0.25, 0.46, 0.45, 0.94)',fn:function(u){return u*(2-u)}},circular:{style:'cubic-bezier(0.1, 0.57, 0.1, 1)',fn:function(u){return g.sqrt(1- --u*u)}},back:{style:'cubic-bezier(0.175, 0.885, 0.32, 1.275)',fn:function(u){var v=4;return--u*u*((v+1)*u+v)+1}},bounce:{style:'',fn:function(u){return(u/=1)<1/2.75?7.5625*u*u:u<2/2.75?7.5625*(u-=1.5/2.75)*u+0.75:u<2.5/2.75?7.5625*(u-=2.25/2.75)*u+0.9375:7.5625*(u-=2.625/2.75)*u+0.984375}},elastic:{style:'',fn:function(u){var v=0.22;return 0===u?0:1==u?1:0.4*g.pow(2,-10*u)*g.sin((u-v/4)*(2*g.PI)/v)+1}}}),q.tap=function(u,v){var w=d.createEvent('Event');w.initEvent(v,!0,!0),w.pageX=u.pageX,w.pageY=u.pageY,u.target.dispatchEvent(w)},q.click=function(u){var w,v=u.target;/(SELECT|INPUT|TEXTAREA)/i.test(v.tagName)||(w=d.createEvent(a.MouseEvent?'MouseEvents':'Event'),w.initEvent('click',!0,!0),w.view=u.view||a,w.detail=1,w.screenX=v.screenX||0,w.screenY=v.screenY||0,w.clientX=v.clientX||0,w.clientY=v.clientY||0,w.ctrlKey=!!u.ctrlKey,w.altKey=!!u.altKey,w.shiftKey=!!u.shiftKey,w.metaKey=!!u.metaKey,w.button=0,w.relatedTarget=null,w._constructed=!0,v.dispatchEvent(w))},q.getTouchAction=function(u,v){var w='none';return'vertical'===u?w='pan-y':'horizontal'==u&&(w='pan-x'),v&&'none'!=w&&(w+=' pinch-zoom'),w},q.getRect=function(u){if(u instanceof SVGElement){var v=u.getBoundingClientRect();return{top:v.top,left:v.left,width:v.width,height:v.height}}return{top:u.offsetTop,left:u.offsetLeft,width:u.offsetWidth,height:u.offsetHeight}},q}();h.prototype={version:'5.2.0-snapshot',_init:function(){this._initEvents(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys(),this.options.infiniteElements&&this._initInfinite()},destroy:function(){this._initEvents(!0),clearTimeout(this.resizeTimeout),this.resizeTimeout=null,this._execEvent('destroy')},_transitionEnd:function(p){p.target==this.scroller&&this.isInTransition&&(this._transitionTime(),!this.resetPosition(this.options.bounceTime)&&(this.isInTransition=!1,this._execEvent('scrollEnd')))},_start:function(p){if(1!=o.eventType[p.type]){var q;if(q=p.which?p.button:2>p.button?0:4==p.button?1:2,0!==q)return}if(this.enabled&&(!this.initiated||o.eventType[p.type]===this.initiated)){!this.options.preventDefault||o.isBadAndroid||o.preventDefaultException(p.target,this.options.preventDefaultException)||p.preventDefault();var s,r=p.touches?p.touches[0]:p;this.initiated=o.eventType[p.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this.startTime=o.getTime(),this.options.useTransition&&this.isInTransition?(this._transitionTime(),this.isInTransition=!1,s=this.getComputedPosition(),this._translate(g.round(s.x),g.round(s.y)),this._execEvent('scrollEnd')):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent('scrollEnd')),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=r.pageX,this.pointY=r.pageY,this._execEvent('beforeScrollStart')}},_move:function(p){if(this.enabled&&o.eventType[p.type]===this.initiated){this.options.preventDefault&&p.preventDefault();var u,v,w,z,q=p.touches?p.touches[0]:p,r=q.pageX-this.pointX,s=q.pageY-this.pointY,t=o.getTime();if(this.pointX=q.pageX,this.pointY=q.pageY,this.distX+=r,this.distY+=s,w=g.abs(this.distX),z=g.abs(this.distY),!(300<t-this.endTime&&10>w&&10>z)){if(this.directionLocked||this.options.freeScroll||(w>z+this.options.directionLockThreshold?this.directionLocked='h':z>=w+this.options.directionLockThreshold?this.directionLocked='v':this.directionLocked='n'),'h'==this.directionLocked){if('vertical'==this.options.eventPassthrough)p.preventDefault();else if('horizontal'==this.options.eventPassthrough)return void(this.initiated=!1);s=0}else if('v'==this.directionLocked){if('horizontal'==this.options.eventPassthrough)p.preventDefault();else if('vertical'==this.options.eventPassthrough)return void(this.initiated=!1);r=0}r=this.hasHorizontalScroll?r:0,s=this.hasVerticalScroll?s:0,u=this.x+r,v=this.y+s,(0<u||u<this.maxScrollX)&&(u=this.options.bounce?this.x+r/3:0<u?0:this.maxScrollX),(0<v||v<this.maxScrollY)&&(v=this.options.bounce?this.y+s/3:0<v?0:this.maxScrollY),this.directionX=0<r?-1:0>r?1:0,this.directionY=0<s?-1:0>s?1:0,this.moved||this._execEvent('scrollStart'),this.moved=!0,this._translate(u,v),300<t-this.startTime&&(this.startTime=t,this.startX=this.x,this.startY=this.y,1==this.options.probeType&&this._execEvent('scroll')),1<this.options.probeType&&this._execEvent('scroll')}}},_end:function(p){if(this.enabled&&o.eventType[p.type]===this.initiated){this.options.preventDefault&&!o.preventDefaultException(p.target,this.options.preventDefaultException)&&p.preventDefault();var r,s,q=p.changedTouches?p.changedTouches[0]:p,t=o.getTime()-this.startTime,u=g.round(this.x),v=g.round(this.y),w=g.abs(u-this.startX),z=g.abs(v-this.startY),A=0,B='';if(this.isInTransition=0,this.initiated=0,this.endTime=o.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(u,v),!this.moved)return this.options.tap&&o.tap(p,this.options.tap),this.options.click&&o.click(p),void this._execEvent('scrollCancel');if(this._events.flick&&200>t&&100>w&&100>z)return void this._execEvent('flick');if(this.options.momentum&&300>t&&(r=this.hasHorizontalScroll?o.momentum(this.x,this.startX,t,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:u,duration:0},s=this.hasVerticalScroll?o.momentum(this.y,this.startY,t,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:v,duration:0},u=r.destination,v=s.destination,A=g.max(r.duration,s.duration),this.isInTransition=1),this.options.snap){var C=this._nearestSnap(u,v);this.currentPage=C,A=this.options.snapSpeed||g.max(g.max(g.min(g.abs(u-C.x),1e3),g.min(g.abs(v-C.y),1e3)),300),u=C.x,v=C.y,this.directionX=0,this.directionY=0,B=this.options.bounceEasing}return u!=this.x||v!=this.y?((0<u||u<this.maxScrollX||0<v||v<this.maxScrollY)&&(B=o.ease.quadratic),void this.scrollTo(u,v,A,B)):void this._execEvent('scrollEnd')}}},_resize:function(){var p=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){p.refresh()},this.options.resizePolling)},resetPosition:function(p){var q=this.x,r=this.y;return(p=p||0,!this.hasHorizontalScroll||0<this.x?q=0:this.x<this.maxScrollX&&(q=this.maxScrollX),!this.hasVerticalScroll||0<this.y?r=0:this.y<this.maxScrollY&&(r=this.maxScrollY),q!=this.x||r!=this.y)&&(this.scrollTo(q,r,p,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){o.getRect(this.wrapper),this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight;var p=o.getRect(this.scroller);this.scrollerWidth=p.width,this.scrollerHeight=p.height,this.maxScrollX=this.wrapperWidth-this.scrollerWidth;var q;this.options.infiniteElements&&(this.options.infiniteLimit=this.options.infiniteLimit||g.floor(2147483645/this.infiniteElementHeight),q=-this.options.infiniteLimit*this.infiniteElementHeight+this.wrapperHeight),this.maxScrollY=q==void 0?this.wrapperHeight-this.scrollerHeight:q,this.hasHorizontalScroll=this.options.scrollX&&0>this.maxScrollX,this.hasVerticalScroll=this.options.scrollY&&0>this.maxScrollY,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,o.hasPointer&&!this.options.disablePointer&&(this.wrapper.style[o.style.touchAction]=o.getTouchAction(this.options.eventPassthrough,!0),!this.wrapper.style[o.style.touchAction]&&(this.wrapper.style[o.style.touchAction]=o.getTouchAction(this.options.eventPassthrough,!1))),this.wrapperOffset=o.offset(this.wrapper),this._execEvent('refresh'),this.resetPosition()},on:function(p,q){this._events[p]||(this._events[p]=[]),this._events[p].push(q)},off:function(p,q){if(this._events[p]){var r=this._events[p].indexOf(q);-1<r&&this._events[p].splice(r,1)}},_execEvent:function(p){if(this._events[p]){var q=0,r=this._events[p].length;if(r)for(;q<r;q++)this._events[p][q].apply(this,[].slice.call(arguments,1))}},scrollBy:function(p,q,r,s){p=this.x+p,q=this.y+q,r=r||0,this.scrollTo(p,q,r,s)},scrollTo:function(p,q,r,s){s=s||o.ease.circular,this.isInTransition=this.options.useTransition&&0<r;var t=this.options.useTransition&&s.style;!r||t?(t&&(this._transitionTimingFunction(s.style),this._transitionTime(r)),this._translate(p,q)):this._animate(p,q,r,s.fn)},scrollToElement:function(p,q,r,s,t){if(p=p.nodeType?p:this.scroller.querySelector(p),!!p){var u=o.offset(p);u.left-=this.wrapperOffset.left,u.top-=this.wrapperOffset.top;var v=o.getRect(p),w=o.getRect(this.wrapper);!0===r&&(r=g.round(v.width/2-w.width/2)),!0===s&&(s=g.round(v.height/2-w.height/2)),u.left-=r||0,u.top-=s||0,u.left=0<u.left?0:u.left<this.maxScrollX?this.maxScrollX:u.left,u.top=0<u.top?0:u.top<this.maxScrollY?this.maxScrollY:u.top,q=void 0===q||null===q||'auto'===q?g.max(g.abs(this.x-u.left),g.abs(this.y-u.top)):q,this.scrollTo(u.left,u.top,q,t)}},_transitionTime:function(p){if(this.options.useTransition){p=p||0;var q=o.style.transitionDuration;if(q&&(this.scrollerStyle[q]=p+'ms',!p&&o.isBadAndroid)){this.scrollerStyle[q]='0.0001ms';var r=this;j(function(){'0.0001ms'===r.scrollerStyle[q]&&(r.scrollerStyle[q]='0s')})}}},_transitionTimingFunction:function(p){this.scrollerStyle[o.style.transitionTimingFunction]=p},_translate:function(p,q){this.options.useTransform?this.scrollerStyle[o.style.transform]='translate('+p+'px,'+q+'px)'+this.translateZ:(p=g.round(p),q=g.round(q),this.scrollerStyle.left=p+'px',this.scrollerStyle.top=q+'px'),this.x=p,this.y=q},_initEvents:function(p){var q=p?o.removeEvent:o.addEvent,r=this.options.bindToWrapper?this.wrapper:a;q(a,'orientationchange',this),q(a,'resize',this),this.options.click&&q(this.wrapper,'click',this,!0),this.options.disableMouse||(q(this.wrapper,'mousedown',this),q(r,'mousemove',this),q(r,'mousecancel',this),q(r,'mouseup',this)),o.hasPointer&&!this.options.disablePointer&&(q(this.wrapper,o.prefixPointerEvent('pointerdown'),this),q(r,o.prefixPointerEvent('pointermove'),this),q(r,o.prefixPointerEvent('pointercancel'),this),q(r,o.prefixPointerEvent('pointerup'),this)),o.hasTouch&&!this.options.disableTouch&&(q(this.wrapper,'touchstart',this),q(r,'touchmove',this),q(r,'touchcancel',this),q(r,'touchend',this)),q(this.scroller,'transitionend',this),q(this.scroller,'webkitTransitionEnd',this),q(this.scroller,'oTransitionEnd',this),q(this.scroller,'MSTransitionEnd',this)},getComputedPosition:function(){var q,r,p=a.getComputedStyle(this.scroller,null);return this.options.useTransform?(p=p[o.style.transform].split(')')[0].split(', '),q=+(p[12]||p[4]),r=+(p[13]||p[5])):(q=+p.left.replace(/[^-\d.]/g,''),r=+p.top.replace(/[^-\d.]/g,'')),{x:q,y:r}},_initWheel:function(){o.addEvent(this.wrapper,'wheel',this),o.addEvent(this.wrapper,'mousewheel',this),o.addEvent(this.wrapper,'DOMMouseScroll',this),this.on('destroy',function(){clearTimeout(this.wheelTimeout),this.wheelTimeout=null,o.removeEvent(this.wrapper,'wheel',this),o.removeEvent(this.wrapper,'mousewheel',this),o.removeEvent(this.wrapper,'DOMMouseScroll',this)})},_wheel:function(p){if(this.enabled){p.preventDefault();var q,r,s,t,u=this;if(void 0===this.wheelTimeout&&u._execEvent('scrollStart'),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){u.options.snap||u._execEvent('scrollEnd'),u.wheelTimeout=void 0},400),'deltaX'in p)1===p.deltaMode?(q=-p.deltaX*this.options.mouseWheelSpeed,r=-p.deltaY*this.options.mouseWheelSpeed):(q=-p.deltaX,r=-p.deltaY);else if('wheelDeltaX'in p)q=p.wheelDeltaX/120*this.options.mouseWheelSpeed,r=p.wheelDeltaY/120*this.options.mouseWheelSpeed;else if('wheelDelta'in p)q=r=p.wheelDelta/120*this.options.mouseWheelSpeed;else if('detail'in p)q=r=-p.detail/3*this.options.mouseWheelSpeed;else return;return q*=this.options.invertWheelDirection,r*=this.options.invertWheelDirection,this.hasVerticalScroll||(q=r,r=0),this.options.snap?(s=this.currentPage.pageX,t=this.currentPage.pageY,0<q?s--:0>q&&s++,0<r?t--:0>r&&t++,void this.goToPage(s,t)):void(s=this.x+g.round(this.hasHorizontalScroll?q:0),t=this.y+g.round(this.hasVerticalScroll?r:0),this.directionX=0<q?-1:0>q?1:0,this.directionY=0<r?-1:0>r?1:0,0<s?s=0:s<this.maxScrollX&&(s=this.maxScrollX),0<t?t=0:t<this.maxScrollY&&(t=this.maxScrollY),this.scrollTo(s,t,0),1<this.options.probeType&&this._execEvent('scroll'))}},_initSnap:function(){this.currentPage={},'string'==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on('refresh',function(){var q,s,t,u,w,B,C,p=0,r=0,v=0,z=this.options.snapStepX||this.wrapperWidth,A=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(!0===this.options.snap)for(t=g.round(z/2),u=g.round(A/2);v>-this.scrollerWidth;){for(this.pages[p]=[],q=0,w=0;w>-this.scrollerHeight;)this.pages[p][q]={x:g.max(v,this.maxScrollX),y:g.max(w,this.maxScrollY),width:z,height:A,cx:v-t,cy:w-u},w-=A,q++;v-=z,p++}else for(B=this.options.snap,q=B.length,s=-1;p<q;p++)C=o.getRect(B[p]),(0==p||C.left<=o.getRect(B[p-1]).left)&&(r=0,s++),this.pages[r]||(this.pages[r]=[]),v=g.max(-C.left,this.maxScrollX),w=g.max(-C.top,this.maxScrollY),t=v-g.round(C.width/2),u=w-g.round(C.height/2),this.pages[r][s]={x:v,y:w,width:C.width,height:C.height,cx:t,cy:u},v>this.maxScrollX&&r++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),0==this.options.snapThreshold%1?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=g.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=g.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on('flick',function(){var p=this.options.snapSpeed||g.max(g.max(g.min(g.abs(this.x-this.startX),1e3),g.min(g.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,p)})},_nearestSnap:function(p,q){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var r=0,s=this.pages.length,t=0;if(g.abs(p-this.absStartX)<this.snapThresholdX&&g.abs(q-this.absStartY)<this.snapThresholdY)return this.currentPage;for(0<p?p=0:p<this.maxScrollX&&(p=this.maxScrollX),0<q?q=0:q<this.maxScrollY&&(q=this.maxScrollY);r<s;r++)if(p>=this.pages[r][0].cx){p=this.pages[r][0].x;break}for(s=this.pages[r].length;t<s;t++)if(q>=this.pages[0][t].cy){q=this.pages[0][t].y;break}return r==this.currentPage.pageX&&(r+=this.directionX,0>r?r=0:r>=this.pages.length&&(r=this.pages.length-1),p=this.pages[r][0].x),t==this.currentPage.pageY&&(t+=this.directionY,0>t?t=0:t>=this.pages[0].length&&(t=this.pages[0].length-1),q=this.pages[0][t].y),{x:p,y:q,pageX:r,pageY:t}},goToPage:function(p,q,r,s){s=s||this.options.bounceEasing,p>=this.pages.length?p=this.pages.length-1:0>p&&(p=0),q>=this.pages[p].length?q=this.pages[p].length-1:0>q&&(q=0);var t=this.pages[p][q].x,u=this.pages[p][q].y;r=r===void 0?this.options.snapSpeed||g.max(g.max(g.min(g.abs(t-this.x),1e3),g.min(g.abs(u-this.y),1e3)),300):r,this.currentPage={x:t,y:u,pageX:p,pageY:q},this.scrollTo(t,u,r,s)},next:function(p,q){var r=this.currentPage.pageX,s=this.currentPage.pageY;r++,r>=this.pages.length&&this.hasVerticalScroll&&(r=0,s++),this.goToPage(r,s,p,q)},prev:function(p,q){var r=this.currentPage.pageX,s=this.currentPage.pageY;r--,0>r&&this.hasVerticalScroll&&(r=0,s--),this.goToPage(r,s,p,q)},_initKeys:function(){var q={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40},r;if('object'==typeof this.options.keyBindings)for(r in this.options.keyBindings)'string'==typeof this.options.keyBindings[r]&&(this.options.keyBindings[r]=this.options.keyBindings[r].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(r in q)this.options.keyBindings[r]=this.options.keyBindings[r]||q[r];o.addEvent(a,'keydown',this),this.on('destroy',function(){o.removeEvent(a,'keydown',this)})},_key:function(p){if(this.enabled){var w,q=this.options.snap,r=q?this.currentPage.pageX:this.x,s=q?this.currentPage.pageY:this.y,t=o.getTime(),u=this.keyTime||0;switch(this.options.useTransition&&this.isInTransition&&(w=this.getComputedPosition(),this._translate(g.round(w.x),g.round(w.y)),this.isInTransition=!1),this.keyAcceleration=200>t-u?g.min(this.keyAcceleration+0.25,50):0,p.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?r+=q?1:this.wrapperWidth:s+=q?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?r-=q?1:this.wrapperWidth:s-=q?1:this.wrapperHeight;break;case this.options.keyBindings.end:r=q?this.pages.length-1:this.maxScrollX,s=q?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:r=0,s=0;break;case this.options.keyBindings.left:r+=q?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:s+=q?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:r-=q?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:s-=q?1:5+this.keyAcceleration>>0;break;default:return;}return q?void this.goToPage(r,s):void(0<r?(r=0,this.keyAcceleration=0):r<this.maxScrollX&&(r=this.maxScrollX,this.keyAcceleration=0),0<s?(s=0,this.keyAcceleration=0):s<this.maxScrollY&&(s=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(r,s,0),this.keyTime=t)}},_animate:function(p,q,r,s){function t(){var C,D,E,B=o.getTime();return B>=z+r?(u.isAnimating=!1,u._translate(p,q),void(u.resetPosition(u.options.bounceTime)||u._execEvent('scrollEnd'))):void(B=(B-z)/r,E=s(B),C=(p-v)*E+v,D=(q-w)*E+w,u._translate(C,D),u.isAnimating&&j(t),3==u.options.probeType&&u._execEvent('scroll'))}var u=this,v=this.x,w=this.y,z=o.getTime();this.isAnimating=!0,t()},_initInfinite:function(){var p=this.options.infiniteElements;this.infiniteElements='string'==typeof p?d.querySelectorAll(p):p,this.infiniteLength=this.infiniteElements.length,this.infiniteMaster=this.infiniteElements[0],this.infiniteElementHeight=o.getRect(this.infiniteMaster).height,this.infiniteHeight=this.infiniteLength*this.infiniteElementHeight,this.options.cacheSize=this.options.cacheSize||1e3,this.infiniteCacheBuffer=g.round(this.options.cacheSize/4),this.options.dataset.call(this,0,this.options.cacheSize),this.on('refresh',function(){var q=g.ceil(this.wrapperHeight/this.infiniteElementHeight);this.infiniteUpperBufferSize=g.floor((this.infiniteLength-q)/2),this.reorderInfinite()}),this.on('scroll',this.reorderInfinite)},reorderInfinite:function(){for(var p=-this.y+this.wrapperHeight/2,q=g.max(g.floor(-this.y/this.infiniteElementHeight)-this.infiniteUpperBufferSize,0),r=g.floor(q/this.infiniteLength),s=q-r*this.infiniteLength,t=0,u=0,v=[],w=g.floor(q/this.infiniteCacheBuffer);u<this.infiniteLength;)t=u*this.infiniteElementHeight+r*this.infiniteHeight,s>u&&(t+=this.infiniteElementHeight*this.infiniteLength),this.infiniteElements[u]._top!==t&&(this.infiniteElements[u]._phase=t/this.infiniteElementHeight,this.infiniteElements[u]._phase<this.options.infiniteLimit&&(this.infiniteElements[u]._top=t,this.options.infiniteUseTransform?this.infiniteElements[u].style[o.style.transform]='translate(0, '+t+'px)'+this.translateZ:this.infiniteElements[u].style.top=t+'px',v.push(this.infiniteElements[u]))),u++;this.cachePhase!=w&&(0===w||0<q-this.infiniteCacheBuffer)&&this.options.dataset.call(this,g.max(w*this.infiniteCacheBuffer-this.infiniteCacheBuffer,0),this.options.cacheSize),this.cachePhase=w,this.updateContent(v)},updateContent:function(p){if(void 0!==this.infiniteCache)for(var q=0,r=p.length;q<r;q++)this.options.dataFiller.call(this,p[q],this.infiniteCache[p[q]._phase])},updateCache:function(p,q){var r=this.infiniteCache===void 0;this.infiniteCache={};for(var s=0,t=q.length;s<t;s++)this.infiniteCache[p++]=q[s];r&&this.updateContent(this.infiniteElements)},handleEvent:function(p){switch(p.type){case'touchstart':case'pointerdown':case'MSPointerDown':case'mousedown':this._start(p);break;case'touchmove':case'pointermove':case'MSPointerMove':case'mousemove':this._move(p);break;case'touchend':case'pointerup':case'MSPointerUp':case'mouseup':case'touchcancel':case'pointercancel':case'MSPointerCancel':case'mousecancel':this._end(p);break;case'orientationchange':case'resize':this._resize();break;case'transitionend':case'webkitTransitionEnd':case'oTransitionEnd':case'MSTransitionEnd':this._transitionEnd(p);break;case'wheel':case'DOMMouseScroll':case'mousewheel':this._wheel(p);break;case'keydown':this._key(p);break;case'click':this.enabled&&!p._constructed&&(p.preventDefault(),p.stopPropagation());}}},h.utils=o,'undefined'!=typeof module&&module.exports?module.exports=h:'function'==typeof define&&define.amd?define(function(){return h}):a.IScroll=h})(window,document,Math);
